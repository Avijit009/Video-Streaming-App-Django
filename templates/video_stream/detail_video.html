{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="container">
        <div class="row mt-5">
            <div class="col-md-8 col-sm-12 col-xs-12">
                <video-js
                    width="720"
                    height="405"
                    controls
                    data-setup='{"playbackRates": [0.5, 1, 1.5, 2], "fluid": true}'>
                    <source src="/media/{{ object.video_file }}" type="video/mp4">
                    <p class="vjs-no-js">
                    To view this video please enable Javascript, and consider upgrading to a web browser that <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                    </p>
                </video-js>
                <hr>
                <div class="d-flex justify-content-between">
                    <p class="text-muted text-left m-0"> Category: {{ category.name }}</p>
                    <p class="text-muted text-right m-0"> Views: {{ object.view_count }}</p>
                </div>
                <hr>
                <style>
                    .btn-like:hover {
                        background-color: #5cb85c; /* Change the background color on hover */
                    }

                    .btn-unlike:hover {
                        background-color: #d9534f; /* Change the background color on hover */
                    }
                </style>

                {% if user.is_authenticated %}
                <form method="POST" action="{% url 'video_detail' pk=object.pk %}" id="likeForm">
                    {% csrf_token %}
                    <button onclick="like();" type="submit" class="btn btn-success btn-sm btn-like likeButton" name="like">
                        <i class="fa fa-thumbs-o-up" aria-hidden="true">Like</i>
                    </button>

                    <button onclick="unlike();" type="submit" class="btn btn-danger btn-sm btn-unlike unlikeButton" name="unlike">
                        <i class="fa fa-thumbs-o-down" aria-hidden="true">Unlike</i>
                    </button>
                </form>
                {% else %}
                <p class="text-danger">Please <a href="{% url 'signin' %}">Sign In</a> to like or dislike this video.</p>
                {% endif %}

                <script>
                    function like(){
                        const likeBtn = document.querySelector('.likeButton');
                        if(likeBtn.innerText === 'Like'){
                            likeBtn.innerHTML = 'Liked';
                        } else{
                            likeBtn.innerHTML = 'Like';
                        }
                    }
                    function unlike(){
                        const unlikeBtn = document.querySelector('.unlikeButton');
                        if(unlikeBtn.innerText  === 'Unlike'){
                            unlikeBtn.innerHTML = 'Unliked';
                        } else{
                            unlikeBtn.innerHTML = 'Unlike';
                        }
                    }
                </script>

                <div>
                    Likes: {{ likes }}
                    Dislikes: {{ unlikes }}
                </div>
                <hr>
                <h5 class="mt-4">{{ object.title }}</h5>
                <hr>
                <p> <span class="font-weight-bold text-secondary">Descritption: </span>{{ object.description }}</p>

                {% if object.uploader == user %}
                <button type="submit" class="btn btn-secondary btn-sm"><a class="video-icons icon-color" style="color:white" href="{% url 'update' object.pk %}">Update</a></button>

                <button type="submit" class="btn btn bg-danger btn-sm"><a class="video-icons icon-color" style="color:white" href="{% url 'remove' object.pk %}">Remove</a></button>
                {% endif %}
            </div>
            <div class="col-md-4 col-sm-12 col-xs-12">
                <h3 class="text-center mb-3">Similar Videos</h3>
                {% for category in categories %}
                    {% if object.pk != category.pk %}
                        <div class="position-relative d-flex flex-row mb-5 py-2 border-bottom">
                            <img src="{{ category.thumbnail.url }}" width="100" height="50" />
                            <h5 class="pl-3">{{ category.title }}</h5>
                            <a href="{% url 'video-detail' category.pk %}" class="stretched-link"></a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <hr/>
        <h3 class="font-weight-bold">Comment on this video</h3>
        <hr/>
        {% for comment in comments %}
        <div class="row mt-3">
            <div class="col-md-8 col-sm-12 border-bottom">
                <h5>{{ comment.user }} says:</h5>
                <p>{{ comment.comment }}</p>
            </div>
        </div>
        {% endfor %}
        <div class="row mt-3">
            <div class="col-md-8 col-sm-12">
                {% if user.is_authenticated %}
                <form method="POST">
                    {% csrf_token %}
                    <legend class="border-bottom mb-4">Leave a Comment!</legend>
                    {{ form | crispy }}
                    <button class="btn btn-outline-info btn-block">Post</button>
                </form>
                {% else %}
                <p class="text-danger">Please <a href="{% url 'signin' %}">sign in</a> to post a comment!</p>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock content %}